{"version":3,"sources":["demo/Alert/AutoFocusAlert.js","demo/DynamicForm/DynamicFormChild.js","demo/DynamicForm/EditCustomForm.js","demo/DynamicForm/SchemaForm.js","service/data-service.js","env.js"],"names":["AutoFocusAlert","props","refAlert","React","createRef","this","scrollToVisible","alert","current","scrollIntoView","variant","alertVariant","ref","PureComponent","DynamicFormChild","refreshCount","console","log","schema","onSubmit","onError","formData","showErrorList","EditCustomForm","prefillForm","id","a","findItemById","then","listResult","length","item","chg","Object","entries","k","v","d","formatJson","dataToSave","dataForRJSF","adaptFormDefinition","type","setState","Promise","reject","loadSchema","form","SchemaForm","resolve","description","content","properties","showError","err","showWarn","msg","showSuccess","ready","showInfo","handleFormChange","ev","change","target","name","value","data","transformToSave","JSON","stringify","saveItem","state","res","status","message","callbackRefresh","json","listFields","assign","required","forEach","propOriginal","i","prop","fieldName","booleanRequired","push","format","enum","enumValues","split","s","trim","jsonOriginal","getOwnPropertyNames","join","includes","e","stack","varient","idReadOnly","Boolean","param","catch","suggestedId","initialDescription","initialData","className","Prepend","Text","Control","placeholder","onChange","aria-describedby","disabled","displayDataTypes","src","collapsed","dependencies","title","findItems","searchText","path","url","serviceUrl","fetch","deleteItemById","method","mode","headers","Headers","body","moviesServiceUrl"],"mappings":"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","file":"static/js/11.ab711d10.chunk.js","sourcesContent":["import React, { PureComponent } from \"react\";\r\nimport Alert from 'react-bootstrap/Alert';\r\n\r\nclass AutoFocusAlert extends PureComponent {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.refAlert = React.createRef();    \r\n  }\r\n  componentDidMount() {\r\n    this.scrollToVisible(); \r\n  }\r\n  componentDidUpdate() {\r\n    this.scrollToVisible();\r\n  }\r\n\r\n  scrollToVisible() {\r\n    if(this.props.alert && this.refAlert) {\r\n\t\t\tthis.refAlert.current.scrollIntoView();\r\n\t\t\t// console.log('scrollIntoView', this.refAlert.current);\r\n\t\t}\r\n  }\r\n\r\n\r\n  render() {\r\n    return \t<>\t\t\r\n      { this.props.alert &&\r\n\t\t\t\t<Alert variant={this.props.alertVariant} ref={this.refAlert} >\r\n\t\t\t\t\t{this.props.alert}\r\n\t\t\t\t</Alert>\r\n\t\t\t}\r\n      </>;\r\n  }\r\n}\r\nexport default AutoFocusAlert;\r\n  \r\n  ","import React, { PureComponent } from \"react\";\r\nimport CustomForm from \"@rjsf/core\";\r\n\r\nclass DynamicFormChild extends PureComponent {\r\n\r\n  constructor(props) {\r\n\t  super(props);\r\n\t  this.refreshCount = 0;\r\n  }\r\n\r\n  render() {\r\n\tthis.refreshCount++;\r\n\tconsole.log('DynamicFormChild render', this.refreshCount);\r\n\r\n\treturn (\r\n\t\t\t\t\t\t<CustomForm schema={this.props.schema}\r\n\t\t\t\t\t\t\t\tonSubmit={this.props.onSubmit}\r\n\t\t\t\t\t\t\t\tonError={this.props.onError} \r\n\t\t\t\t\t\t\t\tformData={this.props.formData}\r\n\t\t\t\t\t\t\t\tshowErrorList={false} \t>\r\n\t\t\t\t\t\t</CustomForm>\r\n\t);\r\n  }\r\n\r\n}\r\n\r\nexport default DynamicFormChild;","import React, { PureComponent } from \"react\";\r\nimport Form from 'react-bootstrap/Form';\r\nimport InputGroup from 'react-bootstrap/InputGroup';\r\nimport AutoFocusAlert from '../Alert/AutoFocusAlert';\r\nimport ReactJson from 'react-json-view';\r\nimport { findItemById, saveItem } from '../../service/data-service';\r\nimport { formatJson } from '../../service/utils';\r\nimport DynamicFormChild from './DynamicFormChild';\r\nimport SchemaForm from './SchemaForm';\r\n\r\nclass EditCustomForm extends PureComponent {\r\n\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\t// item id : props.item \r\n\t\tthis.state = {\r\n\t\t\talert : 'Loading...',\r\n\t\t\tvarient : 'info'\r\n\t\t};\r\n\t\tthis.idReadOnly = Boolean(props.param.id);\r\n\t\tthis.dataForRJSF = {};\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\t// the call 'setState' is available after 'mount.\r\n\t\tif(this.props.param.id) {\r\n\t\t\tconsole.log('create an prefield form');\r\n\t\t\tthis.prefillForm(this.props.param.id)\r\n\t\t\t.then(()=> { \r\n\t\t\t\tthis.showSuccess()\r\n\t\t\t}).catch((e)=> this.showError('Error while loading : '+e));\r\n\t\t} else {\r\n\t\t\tconsole.log('create an empty form');\r\n\t\t\tthis.loadSchema(this.props.param.form)\r\n\t\t\t.then((form)=> {\r\n\t\t\t\tthis.setState({ \r\n\t\t\t\t\tid : this.props.param.suggestedId,\r\n\t\t\t\t\ttype : form.id,\r\n\t\t\t\t\tdescription : this.props.param.initialDescription? this.props.param.initialDescription : null,\r\n\t\t\t\t\tdataToSave : this.props.param.initialData? this.props.param.initialData : null \r\n\t\t\t\t});\r\n\t\t\t\tthis.dataForRJSF = this.adaptFormDefinition(this.props.param.initialData, form.id);\r\n\t\t\t\treturn this.showSuccess();\r\n\t\t\t})\r\n\t\t\t.catch((e)=> {\r\n\t\t\t\tconsole.log(e);\r\n\t\t\t\tthis.showError('Error while loading : '+e)} );\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n   prefillForm = async (id) => {\r\n\t\treturn findItemById(id).then(\r\n\t\t\t\t(listResult) => {\r\n\t\t\t\t\tif(listResult.length>0) {\r\n\t\t\t\t\t\tlet item = listResult[0];\r\n\t\t\t\t\t\tlet chg = {};\r\n\t\t\t\t\t\tfor (let [k, v] of Object.entries(item)) {\r\n\t\t\t\t\t\t\tif(k==='content') {\r\n\t\t\t\t\t\t\t\tlet d = formatJson(v);\r\n\t\t\t\t\t\t\t\tchg.dataToSave = d;\r\n\t\t\t\t\t\t\t\tthis.dataForRJSF = this.adaptFormDefinition(d, item.type);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tchg[k] = v;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconsole.log('setState',chg);\r\n\t\t\t\t\t\tthis.setState(chg);\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn Promise.reject(`ID ${id} not found `);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t).then(\r\n\t\t\t(item) => this.loadSchema(item.type)\r\n\t\t);\r\n\t};\r\n\r\n\tloadSchema = async (form) => {\r\n\t\tif(form === 'FORM') {\r\n\t\t\tthis.setState({schema : SchemaForm});\r\n\t\t\tconsole.log('use SchemaForm', SchemaForm);\r\n\t\t\treturn Promise.resolve({id:'FORM', description:'meta schema', schema : SchemaForm });\r\n\t\t}\r\n\t\treturn findItemById(form).then(\r\n\t\t\t\t(listResult) => {\r\n\t\t\t\t\tif(listResult.length>0) {\r\n\t\t\t\t\t\tlet item = listResult[0];\r\n\t\t\t\t\t\tif(item.type!=='FORM') {\r\n\t\t\t\t\t\t\treturn Promise.reject(`Object ID ${form} must be of type FORM (found ${item.type})`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet schema = formatJson(item.content);\r\n\t\t\t\t\t\tif(!schema || !schema.properties) {\r\n\t\t\t\t\t\t\treturn Promise.reject(`Form '${form}' has invalide schema (found ${item.content})`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.setState({schema});\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn Promise.reject(`Form '${form}' not found `);\r\n\t\t\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\r\n\tshowError = (err) => {\r\n\t\t\tthis.setState({ alert: err, alertVariant : 'danger'});\r\n\t};\r\n\tshowWarn = (msg) => {\r\n\t\t\tthis.setState({ alert: msg, alertVariant : 'warning' });\r\n\t};\r\n\tshowSuccess = (msg) => {\r\n\t\t\tthis.setState({ alert: msg, alertVariant : 'success', ready : true});\r\n\t};\r\n\tshowInfo = (msg) => {\r\n\t\t\tthis.setState({  alert: msg, alertVariant : 'info' });\r\n\t};\r\n\r\n\thandleFormChange = (ev) => {\r\n\t\tlet change = {};\r\n\t\tchange[ev.target.name] = ev.target.value;\r\n\t\tthis.setState(change);\r\n\t\t// console.log('handleFormChange', change);\r\n\t};\r\n\r\n\t\r\n    onSubmit = async (data) => {\r\n\t\ttry {\r\n\t\t\tconsole.log('submit', data);\r\n\t\t\tthis.showInfo('Saving...');\r\n\t\t\tlet dataToSave = this.transformToSave(data.formData);\r\n\t\t\tthis.setState({dataToSave});\r\n\t\t\tlet content = JSON.stringify(dataToSave, null, ' ');\r\n\t\t\tlet res = await saveItem({\r\n\t\t\t\tid : this.state.id,\r\n\t\t\t\ttype : this.state.type,\r\n\t\t\t\tdescription : this.state.description,\r\n\t\t\t\tcontent : content\r\n\t\t\t});\r\n\t\t\t// console.log('result', res);\r\n\t\t\tif(res.status==='OK') {\r\n\t\t\t\tthis.showSuccess(res.message);\r\n\t\t\t} else {\r\n\t\t\t\tthis.showError(res.message);\r\n\t\t\t}\r\n\t\t\tif(res.status==='OK' && this.props.callbackRefresh) {\r\n\t\t\t\tthis.props.callbackRefresh();\r\n\t\t\t}\r\n\t\t} catch(err) {\r\n\t\t\tconsole.log(err);\r\n\t\t\tthis.showError('' +err);\r\n\t\t}\r\n\r\n\t};\r\n\r\n\ttransformToSave = (json) => {\r\n\t\tif(this.state.type!=='FORM') {\r\n\t\t\treturn json;\r\n\t\t}\r\n\t\t// transform 'listFields' to 'properties'\r\n\t\tif(!json.listFields) {\r\n\t\t\treturn json;\r\n\t\t}\r\n\t\tjson = Object.assign({}, json);\r\n\t\tjson.type = 'object';\r\n\t\tjson.properties = {};\r\n\t\tjson.required = [];\r\n\t\tjson.listFields.forEach( (propOriginal, i) => {\r\n\t\t\tlet prop = Object.assign({}, propOriginal);\r\n\t\t\tjson.properties[prop.fieldName] = prop;\r\n\t\t\tif(prop.booleanRequired) {\r\n\t\t\t\tjson.required.push(prop.fieldName);\r\n\t\t\t}\r\n\t\t\tdelete prop.fieldName;\r\n\t\t\tif(prop.type==='date') {\r\n\t\t\t\tprop.type = 'string';\r\n\t\t\t\tprop.format = 'date';\r\n\t\t\t} else if(prop.type==='enum') {\r\n\t\t\t\tdelete prop.type;\r\n\t\t\t\tprop.enum = [];\r\n\t\t\t\tif(prop.enumValues) {\r\n\t\t\t\t\t//console.log('prop.enumValues', prop.enumValues);\r\n\t\t\t\t\tprop.enumValues.split(',').forEach(\r\n\t\t\t\t\t\t(s) => {\r\n\t\t\t\t\t\t\tprop.enum.push(s.trim());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t\tdelete prop.enumValues;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tdelete json.listFields;\r\n\t\tconsole.log('transformToSave', json);\r\n\t\treturn json\r\n\t}\r\n\r\n\tadaptFormDefinition = (jsonOriginal, type) => {\r\n\t\tif(!jsonOriginal) {\r\n\t\t\treturn {};\r\n\t\t}\r\n\t\tif(type!=='FORM') {\r\n\t\t\treturn jsonOriginal;\r\n\t\t}\r\n\t\tlet json = Object.assign({},jsonOriginal);\r\n\t\t// transform 'listFields' to 'properties'\r\n\t\tif(!json.properties) {\r\n\t\t\treturn json;\r\n\t\t}\r\n\t\tjson.listFields = [];\r\n\t\tObject.getOwnPropertyNames(json.properties).forEach( (v, i) => {\r\n\t\t\tlet prop = json.properties[v];\r\n\t\t\tprop.fieldName = v;\r\n\t\t\tif(prop.format==='date') {\r\n\t\t\t\tprop.type = 'date';\r\n\t\t\t\tdelete prop.format;\r\n\t\t\t} else if(prop.enum) {\r\n\t\t\t\tprop.type = 'enum';\r\n\t\t\t\tprop.enumValues = prop.enum.join(', ');\r\n\t\t\t\tdelete prop.enum;\r\n\t\t\t}\r\n\t\t\tif(json.required && json.required.includes(v)) {\r\n\t\t\t\tprop.booleanRequired = true;\r\n\t\t\t}\r\n\t\t\tjson.listFields.push(prop);\r\n\t\t});\r\n\t\tdelete json.properties;\r\n\t\tconsole.log('adaptFormDefinition', jsonOriginal, json);\r\n\t\treturn json\r\n\t}\r\n\r\n    onError = (e) => {\r\n\t\tthis.showWarn(`Problem with a form? \r\n\t\t\t${(e && e[0] && e[0].stack)? e[0].stack : ''}` );\r\n\t\tconsole.log('Form error', e);\r\n\t};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  \trender() {\r\n\r\n\t\treturn ( <div className=\"px-2\" >\r\n\r\n\t\t\t<AutoFocusAlert alert={this.state.alert} alertVariant={this.state.alertVariant} >\r\n\t\t\t</AutoFocusAlert>\r\n\r\n\t\t\t{ this.state.ready &&\r\n\t\t\t\t<>\r\n\t\t\t\t\t<Form>\r\n\t\t\t\t\t\t<InputGroup className=\"mb-3\">\r\n\t\t\t\t\t\t\t<InputGroup.Prepend>\r\n\t\t\t\t\t\t\t<InputGroup.Text id=\"fieldLabel-id\">Unique ID</InputGroup.Text>\r\n\t\t\t\t\t\t\t</InputGroup.Prepend>\r\n\t\t\t\t\t\t\t<Form.Control \r\n\t\t\t\t\t\t\t\tname=\"id\"\r\n\t\t\t\t\t\t\t\tvalue={this.state.id}\r\n\t\t\t\t\t\t\t\tplaceholder=\"required\"\r\n\t\t\t\t\t\t\t\tonChange={this.handleFormChange}\r\n\t\t\t\t\t\t\t\taria-describedby=\"fieldLabel-id\"\r\n\t\t\t\t\t\t\t\tdisabled={Boolean(this.idReadOnly)}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</InputGroup>\r\n\r\n\t\t\t\t\t\t<InputGroup className=\"mb-3\">\r\n\t\t\t\t\t\t\t<InputGroup.Prepend> \r\n\t\t\t\t\t\t\t<InputGroup.Text id=\"fieldLabel-type\">Type</InputGroup.Text>\r\n\t\t\t\t\t\t\t</InputGroup.Prepend>\r\n\t\t\t\t\t\t\t<Form.Control \r\n\t\t\t\t\t\t\t\tname=\"type\"\r\n\t\t\t\t\t\t\t\tvalue={this.state.type}\r\n\t\t\t\t\t\t\t\taria-describedby=\"fieldLabel-type\"\r\n\t\t\t\t\t\t\t\tdisabled\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</InputGroup>\r\n\r\n\t\t\t\t\t\t<InputGroup className=\"mb-3\">\r\n\t\t\t\t\t\t\t<InputGroup.Prepend>\r\n\t\t\t\t\t\t\t<InputGroup.Text id=\"fieldLabel-description\">Description</InputGroup.Text>\r\n\t\t\t\t\t\t\t</InputGroup.Prepend>\r\n\t\t\t\t\t\t\t<Form.Control \r\n\t\t\t\t\t\t\t\tname=\"description\"\r\n\t\t\t\t\t\t\t\tvalue={this.state.description? this.state.description : ''}\r\n\t\t\t\t\t\t\t\tplaceholder=\"describe your data\"\r\n\t\t\t\t\t\t\t\tonChange={this.handleFormChange}\r\n\t\t\t\t\t\t\t\taria-describedby=\"fieldLabel-description\" />\r\n\t\t\t\t\t\t</InputGroup>\r\n\t\t\t\t\t</Form>\r\n\t\t\t\t\t<div className=\"px-2\" >\r\n\t\t\t\t\t\t<DynamicFormChild schema={this.state.schema}\r\n\t\t\t\t\t\t\t\tonSubmit={this.onSubmit}\r\n\t\t\t\t\t\t\t\tonError={this.onError} \r\n\t\t\t\t\t\t\t\tformData={this.dataForRJSF}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t</DynamicFormChild>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\r\n\t\t\t\t\t{this.state.dataToSave && \r\n\t\t\t\t\t\t<div className=\"py-2\" >\r\n\t\t\t\t\t\t\t<div>View JSON data</div>\r\n\t\t\t\t\t\t\t<ReactJson displayDataTypes={false} src={this.state.dataToSave} collapsed=\"true\"/>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t</>\r\n\t\t\t}\t\r\n\t\t</div>);\r\n \t}\r\n\r\n};\r\nexport default EditCustomForm;\r\n","/* meta schema for defining a form */\r\nconst SchemaForm = {\r\n\t\"title\": \"Let's define a simple form\",\r\n    \"description\": \"To create a complex form, use the 'raw JSON editor'\",\r\n\t\"type\": \"object\",\r\n\t\"properties\": {\r\n\t\t\"title\": {\r\n\t\t\t\"type\": \"string\",\r\n\t\t\t\"default\": \"Title of your form\",\r\n\t\t\t\"title\" : \"Give your form a title\"\r\n\t\t},\r\n\t\t\"listFields\": {\r\n\t\t\t\"type\": \"array\",\r\n\t\t\t\"title\" : \"Manage the fields\",\r\n\t\t\t\"items\": {\r\n\t\t\t\t\"type\" : \"object\", \r\n\t\t\t\t\"required\": [\r\n\t\t\t\t\t\"fieldName\",\r\n\t\t\t\t\t\"type\"\r\n\t\t\t\t], \r\n\t\t\t\t\"properties\" : {\r\n\t\t\t\t\t\"fieldName\" : {\r\n\t\t\t\t\t\t\"type\": \"string\",\r\n\t\t\t\t\t\t\"title\" : \"Techinical field name\",\r\n\t\t\t\t\t\t\"pattern\": \"^[A-Za-z0-9_-]{0,30}$\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\"type\" : {\r\n\t\t\t\t\t\t\"enum\": [\"string\",\"integer\", \"boolean\", \"date\", \"enum\"],\r\n\t\t\t\t\t\t\"default\" : \"string\",\r\n\t\t\t\t\t\t\"title\" : \"Data type\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\"title\" : {\r\n\t\t\t\t\t\t\"type\": \"string\",\r\n\t\t\t\t\t\t\"title\" : \"Title to show in the form\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\"booleanRequired\" : {\r\n\t\t\t\t\t\t\"type\": \"boolean\",\r\n\t\t\t\t\t\t\"title\" : \"Required?\"\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tdependencies : {\r\n\t\t\t\t\t\"type\" : {\r\n\t\t\t\t\t\t\"oneOf\": [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\"properties\": {\r\n\t\t\t\t\t\t\t\t\t\t\"type\": {\"enum\": [\"enum\"]},\r\n\t\t\t\t\t\t\t\t\t\t\"enumValues\" : {\r\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\r\n\t\t\t\t\t\t\t\t\t\t\ttitle : \"Enum values (comma separated)\"\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\"properties\": {\r\n\t\t\t\t\t\t\t\t\t\t\"type\": {\"enum\": [\"string\",\"integer\", \"boolean\", \"date\"]}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t}\r\n\t\t\t\t} \r\n\t\t\t}\r\n\t\t} \r\n\t}\r\n};\r\n\r\nexport default SchemaForm;","import {serviceUrl} from '../env.js';\n\n\n\n/**\n * ex searchText='type=FORM'\n */\nexport async function findItems(searchText) {\n  console.log(`filter with ${searchText}`);\n\n  let path = 'items' + (searchText? '?'+searchText : '');\n  let url = serviceUrl + path;\n  let res = await fetch(url);\n\n  let json = await res.json();\n  console.log(path +' => ', json);\n\n  return json;\n};\n\nexport async function findItemById(id) {\n  console.log(`find by id ${id}`);\n\n  let path = 'items/' +id;\n  let url = serviceUrl + path;\n  let res = await fetch(url);\n\n  let json = await res.json();\n  console.log(path +' => ', json);\n\n  return json;\n};\n\n\nexport async function deleteItemById(id) {\n  console.log(`delete by id ${id}`);\n\n  let path = 'items/' +id+ '/delete';\n  let url = serviceUrl + path;\n  let res = await fetch(url, {\n    method: 'DELETE',\n    mode: 'cors',\n  });\n\n  let json = await res.json();\n  console.log(path +' => ', json);\n\n  return json;\n};\n\n\n\nexport async function saveItem(item) {\n  console.log(`save`, item);\n\n  let path = 'items/save';\n  let url = serviceUrl + path;\n  let res = await fetch(url,  {\n    method: 'POST',\n    headers: new Headers({\n      \"Content-Type\": \"application/json\",\n    }),\n    body: JSON.stringify(item)\n  });\n\n  let json = await res.json();\n  console.log(path +' => ', json);\n\n  return json;\n};\n\n\n\n\n\n","\r\n\r\nexport var serviceUrl =   // 'http://localhost:1234/'; \r\n     'https://generic-db.glitch.me/';\r\n\r\n\r\nexport var moviesServiceUrl =   // 'http://localhost:1234/api/movies'; \r\n     'https://verceltest-smoky.now.sh/api/movies';\r\n"],"sourceRoot":""}