(this.webpackJsonpreactdemo=this.webpackJsonpreactdemo||[]).push([[13,21],{102:function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,a=!1,c=void 0;try{for(var o,i=e[Symbol.iterator]();!(r=(o=i.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(s){a=!0,c=s}finally{try{r||null==i.return||i.return()}finally{if(a)throw c}}return n}}(e,t)||function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.d(t,"a",(function(){return a}))},39:function(e,t,n){"use strict";n.r(t),n.d(t,"findItems",(function(){return i})),n.d(t,"findItemById",(function(){return u})),n.d(t,"deleteItemById",(function(){return f})),n.d(t,"saveItem",(function(){return p})),n.d(t,"formatJson",(function(){return b})),n.d(t,"getTimeStamp",(function(){return h}));var r=n(74),a=n.n(r),c=n(75),o=n(40);function i(e){return s.apply(this,arguments)}function s(){return(s=Object(c.a)(a.a.mark((function e(t){var n,r,c,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("filter with ".concat(t)),n="items"+(t?"?"+t:""),r=o.serviceUrl+n,e.next=5,fetch(r);case 5:return c=e.sent,e.next=8,c.json();case 8:return i=e.sent,console.log(n+" => ",i),e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function u(e){return l.apply(this,arguments)}function l(){return(l=Object(c.a)(a.a.mark((function e(t){var n,r,c,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("find by id ".concat(t)),n="items/"+t,r=o.serviceUrl+n,e.next=5,fetch(r);case 5:return c=e.sent,e.next=8,c.json();case 8:return i=e.sent,console.log(n+" => ",i),e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return d.apply(this,arguments)}function d(){return(d=Object(c.a)(a.a.mark((function e(t){var n,r,c,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete by id ".concat(t)),n="items/"+t+"/delete",r=o.serviceUrl+n,e.next=5,fetch(r,{method:"DELETE",mode:"cors"});case 5:return c=e.sent,e.next=8,c.json();case 8:return i=e.sent,console.log(n+" => ",i),e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=Object(c.a)(a.a.mark((function e(t){var n,r,c,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("save",t),n="items/save",r=o.serviceUrl+n,e.next=5,fetch(r,{method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(t)});case 5:return c=e.sent,e.next=8,c.json();case 8:return i=e.sent,console.log(n+" => ",i),e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){var t;if(!e)return null;try{t=JSON.parse(e)}catch(n){console.log("json invalide",n),t={jsonInvalide:""+n}}return console.log("formatJson",t),"object"===typeof t?t:{nonJsonData:""+t}}function h(){var e=function(e){return(e>9?"":"0")+e},t=new Date,n=t.getMonth()+1,r=e(t.getDate()),a=e(t.getHours()),c=e(t.getMinutes()),o=e(t.getSeconds());return[t.getFullYear(),n,r,"_",a,c,o].join("")}},40:function(e,t,n){"use strict";n.r(t),n.d(t,"serviceUrl",(function(){return r}));var r="https://generic-db.glitch.me/"},51:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return h}));var r=n(74),a=n.n(r),c=n(75),o=n(102),i=n(0),s=n.n(i),u=n(122),l=n(88),f=n(101),d=n(79),p=n(83),m=n.n(p),b=n(39);function h(e){var t=s.a.useState("Loading..."),n=Object(o.a)(t,2),r=n[0],i=n[1],p=s.a.useState(null),h=Object(o.a)(p,2),g=h[0],v=h[1],j=s.a.useState(!1),E=Object(o.a)(j,2),O=E[0],w=E[1],x=s.a.useState(null),I=Object(o.a)(x,2),S=I[0],D=I[1],J=s.a.useState(null),k=Object(o.a)(J,2),T=k[0],L=k[1],N=s.a.useState(new Map),M=Object(o.a)(N,2),P=M[0],C=M[1],F=function(e,t){C(new Map(P.set(e,t))),console.log("updateMap",e,t),"content"===e&&D(Object(b.formatJson)(t))},U=function(e){v(e),i(null)};s.a.useEffect((function(){e.param.id?function(e,t,n){return Object(b.findItemById)(e).then((function(n){if(n.length>0){for(var r=n[0],a=0,c=Object.entries(r);a<c.length;a++){var i=Object(o.a)(c[a],2),s=i[0],u=i[1];console.log("".concat(s,": ").concat(u)),t(s,u)}return r}return Promise.reject("ID ".concat(e," not found "))})).then((function(e){return y(e.type,n)}))}(e.param.id,F,L).then((function(e){i(null),w(!0)})).catch((function(e){return U("Error while loading : "+e)})):y(e.param.form,L).then((function(t){i(null),P.set("type",t.id),F("id",t.id+"_"+e.param.suggestedId),w(!0)})).catch((function(e){return U("Error while loading : "+e)}))}),[]);var A=Boolean(e.param.id),B=function(e){F(e.target.name,e.target.value)},R=function(){var t=Object(c.a)(a.a.mark((function t(n){var r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,console.log("submit",n),U(null),D(n.formData),P.set("content",JSON.stringify(n.formData,null," ")),t.next=7,Object(b.saveItem)({id:P.get("id"),type:P.get("type"),description:P.get("description"),content:P.get("content")});case 7:r=t.sent,console.log("result",r),i("OK"===r.status?r.message:null),v("OK"!==r.status?r.message:null),"OK"===r.status&&e.callbackRefresh&&e.callbackRefresh(),t.next=18;break;case 14:t.prev=14,t.t0=t.catch(0),console.log(t.t0),v("Error "+t.t0);case 18:case"end":return t.stop()}}),t,null,[[0,14]])})));return function(e){return t.apply(this,arguments)}}();return s.a.createElement("div",{className:"px-2"},r&&s.a.createElement(d.a,{variant:"success"},r),g&&s.a.createElement(d.a,{variant:"danger"},g),O&&s.a.createElement(s.a.Fragment,null,s.a.createElement(l.a,null,s.a.createElement(f.a,{className:"mb-3"},s.a.createElement(f.a.Prepend,null,s.a.createElement(f.a.Text,{id:"fieldLabel-id"},"Unique ID")),s.a.createElement(l.a.Control,{name:"id",value:P.get("id"),placeholder:"required",onChange:B,"aria-describedby":"fieldLabel-id",disabled:Boolean(A)})),s.a.createElement(f.a,{className:"mb-3"},s.a.createElement(f.a.Prepend,null,s.a.createElement(f.a.Text,{id:"fieldLabel-type"},"Type")),s.a.createElement(l.a.Control,{name:"type",value:P.get("type"),"aria-describedby":"fieldLabel-type",disabled:!0})),s.a.createElement(f.a,{className:"mb-3"},s.a.createElement(f.a.Prepend,null,s.a.createElement(f.a.Text,{id:"fieldLabel-description"},"Description")),s.a.createElement(l.a.Control,{name:"description",value:P.get("description")?P.get("description"):"",placeholder:"describe your form",onChange:B,"aria-describedby":"fieldLabel-description"}))),s.a.createElement("div",{className:"px-2"},s.a.createElement(u.a,{schema:T,onSubmit:R,onError:function(e){console.error("Form error",e)},formData:S,showErrorList:!1})),S&&s.a.createElement("div",{className:"py-2"},s.a.createElement("div",null,"Json view"),s.a.createElement(m.a,{displayDataTypes:!1,src:S}))))}function y(e,t){return Object(b.findItemById)(e).then((function(n){if(n.length>0){var r=n[0];if("FORM"!==r.type)return Promise.reject("Object ID ".concat(e," must be of type FORM (actuel ").concat(r.type,")"));var a=Object(b.formatJson)(r.content);return a&&a.properties?(t(a),r):Promise.reject("Form ID ".concat(e," has invalide schema (actuel ").concat(r.content,")"))}return Promise.reject("Form ID ".concat(e," not found "))}))}}}]);
//# sourceMappingURL=13.ac58a89e.chunk.js.map